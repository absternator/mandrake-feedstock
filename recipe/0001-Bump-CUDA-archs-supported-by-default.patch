From e70c1c1bef1ff0367bca1139a06e40e1cf2988fb Mon Sep 17 00:00:00 2001
From: John Lees <lees.john6@gmail.com>
Date: Wed, 20 Dec 2023 16:13:02 +0000
Subject: [PATCH 1/2] Bump CUDA archs

---
 CMakeLists.txt | 2 +-
 src/Makefile   | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1b8a18d..428e23f 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -46,7 +46,7 @@ if(CMAKE_CUDA_COMPILER)
 
     enable_language(CUDA)
     set(CUDA_OPTS "-Wreorder -Xcompiler -fPIC -Xcompiler -Wall -Xcompiler -fopenmp -Xptxas -dlcm=ca --cudart static --relocatable-device-code=false")
-    string(APPEND CUDA_OPTS " -gencode arch=compute_70,code=sm_70 -gencode arch=compute_75,code=sm_75 -gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86")
+    string(APPEND CUDA_OPTS " -gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86 -gencode arch=compute_90,code=sm_90")
     if(CMAKE_BUILD_TYPE MATCHES Debug)
         string(APPEND CUDA_OPTS " -G")
     else()
diff --git a/src/Makefile b/src/Makefile
index 4ce170d..70d5ac2 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -22,7 +22,7 @@ PYTHON_LIB = SCE$(shell python3-config --extension-suffix)
 ifdef GENARCH
 	GENCODE=${GENARCH}
 else
-	GENCODE=-gencode arch=compute_70,code=sm_70 -gencode arch=compute_75,code=sm_75  -gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86
+	GENCODE=-gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86 -gencode arch=compute_90,code=sm_90
 endif
 CUDA_LDFLAGS =-L$(LIBLOC)/lib -L${CUDA_HOME}/targets/x86_64-linux/lib/stubs -L${CUDA_HOME}/targets/x86_64-linux/lib
 CUDAFLAGS +=-Xcompiler -fPIC -Xptxas -dlcm=ca --cudart static --relocatable-device-code=true $(GENCODE)
-- 
2.39.3 (Apple Git-145)


From 5761e09fc0ca92def57c92922ba97f0421e5797c Mon Sep 17 00:00:00 2001
From: John Lees <lees.john6@gmail.com>
Date: Wed, 20 Dec 2023 17:09:02 +0000
Subject: [PATCH 2/2] Manually override gencode

---
 src/Makefile | 11 ++++++-----
 1 file changed, 6 insertions(+), 5 deletions(-)

diff --git a/src/Makefile b/src/Makefile
index 70d5ac2..6a2bb8a 100644
--- a/src/Makefile
+++ b/src/Makefile
@@ -19,11 +19,12 @@ CUDA_LDLIBS=-lcudadevrt -lcudart_static $(LDLIBS)
 CPPFLAGS += -DPYTHON_EXT -DNDEBUG -DSCE_EXPORTS $(shell python3 -m pybind11 --includes)
 PYTHON_LIB = SCE$(shell python3-config --extension-suffix)
 
-ifdef GENARCH
-	GENCODE=${GENARCH}
-else
-	GENCODE=-gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86 -gencode arch=compute_90,code=sm_90
-endif
+#ifdef GENARCH
+#	GENCODE=${GENARCH}
+#else
+#	GENCODE=-gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86 -gencode arch=compute_90,code=sm_90
+#endif
+GENCODE=-gencode arch=compute_80,code=sm_80 -gencode arch=compute_86,code=sm_86 -gencode arch=compute_90,code=sm_90
 CUDA_LDFLAGS =-L$(LIBLOC)/lib -L${CUDA_HOME}/targets/x86_64-linux/lib/stubs -L${CUDA_HOME}/targets/x86_64-linux/lib
 CUDAFLAGS +=-Xcompiler -fPIC -Xptxas -dlcm=ca --cudart static --relocatable-device-code=true $(GENCODE)
 
-- 
2.39.3 (Apple Git-145)

